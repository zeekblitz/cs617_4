<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scatterplot Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <canvas id="scatterChart" width="800" height="600"></canvas>

    <script>
        // Load data from CSV file
        fetch('data.csv')
            .then(response => response.text())
            .then(data => {
                const labels = [];
                const dataPoints = [];
                const sizeValues = [];

                // Parse CSV data
                const rows = data.trim().split('\n');
                rows.forEach(row => {
                    const columns = row.split(',');
                    labels.push(columns[0]); // Assuming the first column contains labels
                    const xValue = parseFloat(columns[6]); // Assuming the second column contains x-values
                    const yValue = parseFloat(columns[5]); // Assuming the third column contains y-values
                    const sizeValue = parseFloat(columns[7]); // Assuming the fourth column contains size-values
                    dataPoints.push({ x: xValue, y: yValue });
                    sizeValues.push(sizeValue);
                });

                // Create scatterplot
                const ctx = document.getElementById('scatterChart').getContext('2d');
                const scatterChart = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Scatterplot Example',
                            data: dataPoints,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1,
                            pointRadius: sizeValues.map(value => 5), // Set initial point radius to minimum size (e.g., 5)
                            hoverRadius: sizeValues // Set hover point radius based on sizeValues
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom'
                            },
                            y: {
                                type: 'linear',
                                position: 'left'
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: (tooltipItem) => `${tooltipItem.label}: (${tooltipItem.raw.x}, ${tooltipItem.raw.y})`
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            intersect: false
                        }
                    }
                });

                // Update point radius on hover
                scatterChart.options.plugins.tooltip.callbacks.afterLabel = (tooltipItem) => {
                    const datasetIndex = tooltipItem.datasetIndex;
                    const index = tooltipItem.dataIndex;
                    const dataset = scatterChart.data.datasets[datasetIndex];
                    const minRadius = 5;
                    const maxRadius = sizeValues[index];

                    // Calculate scaled radius based on sizeValue
                    const scaleFactor = (maxRadius - minRadius) / maxRadius;
                    dataset.pointRadius = sizeValues.map((value, i) => {
                        if (i === index) {
                            return maxRadius; // Set hovered point to max radius
                        } else {
                            return minRadius + value * scaleFactor; // Scale other points proportionally
                        }
                    });

                    scatterChart.update();
                };
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    </script>
</body>
</html>
